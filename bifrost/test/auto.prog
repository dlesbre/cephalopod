/*
 * Module that computes the nth Fibonacci number, with the convention that the
 * 0th Fibonacci number is 0. Relies on an adder module "myadder", defined in
 * myadder.prog.
 */

name fib;
protocol twophase;
//protocol twophase powered;

type int => "word";

actiontype Adder = x:int -> y:int -> z:int reading [] writing [];

//action adder:Adder provided by "myadder" via twophase;
action adder:Adder provided by "myadder" via auto;

subroutine main : n:int -> fibnum:int
{
    var int next, nextnext;
    //power on adder;
    fibnum = 0;
    next = 1;

    while(n > 0)
    {
        --%<--
        nextnext = do adder fibnum next;
        fibnum = next;
        next = nextnext;
        n = n - 1;
    }

    return;
}
